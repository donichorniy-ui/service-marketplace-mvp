<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Маркетплейс задач — DEMO</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f6f6f6;
    padding: 16px;
}

.container {
    max-width: 420px;
    margin: 0 auto;
    background: #ffffff;
    padding: 20px;
    border-radius: 14px;
}

h2 {
    font-size: 22px;
    margin-bottom: 16px;
    text-align: center;
}

.block {
    margin-bottom: 18px;
}

label {
    display: block;
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 6px;
}

input,
select,
textarea,
button {
    width: 100%;
    font-size: 16px;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
}

textarea {
    resize: none;
}

button {
    background: #2aabee;
    color: #fff;
    font-size: 17px;
    font-weight: bold;
    border: none;
    cursor: pointer;
}

button:disabled {
    background: #9ecdf0;
    cursor: not-allowed;
}

.status {
    margin-top: 12px;
    font-size: 15px;
    text-align: center;
}
.success { color: green; }
.error { color: red; }
</style>
</head>

<body>

<div class="container">

    <h2>Создание заявки</h2>

    <div class="block">
        <label>Услуга</label>
        <select id="service">
            <option value="Сантехника">Сантехника</option>
            <option value="Мелкий бытовой ремонт">Мелкий бытовой ремонт</option>
        </select>
    </div>

    <div class="block">
        <label>Описание задачи</label>
        <textarea id="description" rows="4"
        placeholder="Кратко опишите, что нужно сделать"></textarea>
    </div>

    <div class="block">
        <label>Стоимость (UZS)</label>
        <input id="price" type="number" placeholder="Например: 150000">
    </div>

    <div class="block">
        <label>Контактный телефон</label>
        <input id="contact" type="tel" placeholder="+998 90 123 45 67">
    </div>

    <div class="block">
        <button id="submit">Отправить заявку</button>
        <div id="status" class="status"></div>
    </div>

</div>

<script>
/* ===== DEMO НАСТРОЙКИ (ЗАВТРА УБЕРЁМ В DJANGO) ===== */
const BOT_TOKEN = "8512972671:AAHKjr5FX6W1rDaAkt0M4h1LdY-ii-BElco";
const ADMIN_CHAT_ID = "5950245139";

/* ===== ЛОГИКА DEMO ===== */
let orderCounter = 0;

async function sendTask(service, description, price, contact) {
    orderCounter++;
    const orderNumber = "#" + orderCounter.toString().padStart(3, "0");

    const payload = {
        chat_id: ADMIN_CHAT_ID,
        text:
`Новая заявка ${orderNumber}
Услуга: ${service}
Описание: ${description}
Цена: ${price} UZS
Контакт: ${contact}
Статус: В ожидании подтверждения`,
        reply_markup: JSON.stringify({
            inline_keyboard: [
                [{ text: "Подтвердить заявку", callback_data: "confirm_" + orderNumber }]
            ]
        })
    };

    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    return orderNumber;
}

/* ===== КНОПКА ===== */
document.getElementById("submit").addEventListener("click", async () => {
    const btn = document.getElementById("submit");
    const status = document.getElementById("status");

    const service = document.getElementById("service").value;
    const description = document.getElementById("description").value.trim();
    const price = document.getElementById("price").value.trim();
    const contact = document.getElementById("contact").value.trim();

    if (!description || !price || !contact) {
        status.textContent = "Заполните все поля";
        status.className = "status error";
        return;
    }

    btn.disabled = true;
    status.textContent = "Отправка заявки...";
    status.className = "status";

    try {
        const orderNumber = await sendTask(service, description, price, contact);
        status.textContent = `Заявка ${orderNumber} успешно отправлена`;
        status.className = "status success";

        document.getElementById("description").value = "";
        document.getElementById("price").value = "";
        document.getElementById("contact").value = "";
    } catch (e) {
        status.textContent = "Ошибка отправки. Попробуйте позже.";
        status.className = "status error";
    }

    btn.disabled = false;
});
</script>

</body>
</html>
